---
// 1. Setup variables
const DRIBBBLE_TOKEN = import.meta.env.DRIBBBLE_TOKEN;
let shots = [];
let isFallback = false;

// 2. Define Fallback Data
// Tip: Replace these image URLs with static images from your /public folder for maximum reliability
const fallbackShots = [
  {
    html_url: "https://dribbble.com/",
    title: "Portfolio Piece One",
    updated_at: new Date().toISOString(),
    images: {
      normal: "https://via.placeholder.com/640x640.png?text=Design+Sample+1",
    },
  },
  {
    html_url: "https://dribbble.com/",
    title: "Portfolio Piece Two",
    updated_at: new Date().toISOString(),
    images: {
      normal: "https://via.placeholder.com/640x640.png?text=Design+Sample+2",
    },
  },
  {
    html_url: "https://dribbble.com/",
    title: "Portfolio Piece Three",
    updated_at: new Date().toISOString(),
    images: {
      normal: "https://via.placeholder.com/640x640.png?text=Design+Sample+3",
    },
  },
  {
    html_url: "https://dribbble.com/",
    title: "Portfolio Piece Four",
    updated_at: new Date().toISOString(),
    images: {
      normal: "https://via.placeholder.com/640x640.png?text=Design+Sample+4",
    },
  },
];

// 3. Fetch Logic
try {
  const response = await fetch(
    `https://api.dribbble.com/v2/user/shots?access_token=${DRIBBBLE_TOKEN}&per_page=4`,
  );

  if (!response.ok) {
    throw new Error(`Dribbble API responded with status: ${response.status}`);
  }

  shots = await response.json();

  // Handle case where API returns empty array
  if (shots.length === 0) {
    shots = fallbackShots;
    isFallback = true;
  }
} catch (error) {
  console.error("Error fetching Dribbble shots:", error);
  shots = fallbackShots;
  isFallback = true;
}

// 4. Helper for Date Formatting
const formatDate = (dateString) => {
  return new Date(dateString).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};
---

<section
  class="dribbble-pink-background border-t border-gray-300 px-10 md:px-0"
>
  <div
    class="container mx-auto py-[40px] lg:py-[50px] px-[20px] lg:px-[60px] md:border-l md:border-r border-gray-300"
  >
    <div class="md:flex items-start justify-between mb-4">
      <div class="md:pr-6 mb-4">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
          height="34"
          width="34"
          class="mb-2 fill-dribbble-pink"
        >
          <path
            d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496zM420 122.4c29.5 36 47.4 82 47.8 132-7-1.5-77-15.7-147.5-6.8-5.8-14-11.2-26.4-18.6-41.6 78.3-32 113.8-77.5 118.3-83.5zM396.4 97.9c-3.8 5.4-35.7 48.3-111 76.5-34.7-63.8-73.2-116.2-79-124 67.2-16.2 138 1.3 190.1 47.5zM165.9 64.6c5.6 7.7 43.4 60.1 78.5 122.5-99.1 26.3-186.4 25.9-195.8 25.8 13.7-65.7 58-120.4 117.3-148.3zM44.2 256.3c0-2.2 0-4.3 .1-6.5 9.3 .2 111.9 1.5 217.7-30.1 6.1 11.9 11.9 23.9 17.2 35.9-76.6 21.6-146.2 83.5-180.5 142.3-33.8-37.6-54.5-87.2-54.5-141.6zM126 423.4c22.1-45.2 82.2-103.6 167.6-132.8 29.7 77.3 42 142.1 45.2 160.6-68.1 29-150 21.1-212.8-27.9zm248.4 8.5c-2.2-12.9-13.4-74.9-41.2-151 66.4-10.6 124.7 6.8 131.9 9.1-9.4 58.9-43.3 109.8-90.8 142z"
          ></path>
        </svg>
        <h2 class="text-2xl font-semibold text-black mb-2">
          Latest Dribbble Shots
        </h2>
        <p class="large-paragraph mb-4 md:mb-0">
          Dribbble is an online platform for creatives to showcase their work
        </p>
      </div>
      <div>
        <a
          href="https://dribbble.com/YOUR_USERNAME"
          class="btn btn-white mb-4"
          target="_blank"
          rel="noopener noreferrer"
        >
          Go To My Dribbble Profile
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path>
          </svg>
        </a>
      </div>
    </div>

    <ul class="grid grid-cols-2 md:grid-cols-4 gap-[20px]">
      {
        shots.map((shot) => (
          <li class="flex flex-col">
            <a
              href={shot.html_url}
              target="_blank"
              rel="noopener noreferrer"
              class="group"
            >
              <img
                src={shot.images.normal}
                alt={shot.title}
                width="640"
                height="640"
                class="w-full rounded-md object-cover mb-2 border border-gray-300 transition-transform duration-300 group-hover:scale-[0.99]"
              />
              <div class="flex flex-col">
                <span class="text-dribbble-pink text-xs font-semibold">
                  {formatDate(shot.published_at)}
                </span>
                <strong class="text-black font-semibold line-clamp-1">
                  {shot.title}
                </strong>
              </div>
            </a>
          </li>
        ))
      }
    </ul>

    {
      isFallback && (
        <div class="mt-8 p-4 bg-gray-50 border border-dashed border-gray-300 rounded text-center">
          <p class="text-sm text-gray-500 italic">
            Currently displaying featured highlights. Check Dribbble for live
            updates!
          </p>
        </div>
      )
    }
  </div>
</section>
